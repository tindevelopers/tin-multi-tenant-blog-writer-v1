# üîê Environment Setup for Multi-Content-Type Testing

This guide will help you set up the required credentials to run authenticated tests.

---

## üìã Required Environment Variables

Add these to your `.env.local` file:

### 1. Supabase Configuration (Required)

```bash
# Your Supabase project URL
NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co

# Your Supabase anon/public key (safe for client-side)
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Your Supabase service role key (server-side only, KEEP SECRET!)
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Alternative name (both work)
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 2. App Configuration (Optional but recommended)

```bash
# Your local app URL
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_API_URL=http://localhost:3000
```

---

## üîç How to Get Your Supabase Credentials

### Step 1: Go to Supabase Dashboard
1. Open [https://supabase.com/dashboard](https://supabase.com/dashboard)
2. Select your project
3. Click on **Project Settings** (gear icon in sidebar)

### Step 2: Navigate to API Settings
1. In Project Settings, click on **API**
2. You'll see the configuration section

### Step 3: Copy Your Credentials

#### Project URL
- Look for: **Project URL**
- Copy the URL (format: `https://xxxxx.supabase.co`)
- Add to `.env.local` as: `NEXT_PUBLIC_SUPABASE_URL`

#### Anon/Public Key
- Look for: **Project API keys** ‚Üí **anon** / **public**
- Copy the key (starts with `eyJ...`)
- Add to `.env.local` as: `NEXT_PUBLIC_SUPABASE_ANON_KEY`

#### Service Role Key
- Look for: **Project API keys** ‚Üí **service_role**
- Click **Reveal** to show the key
- ‚ö†Ô∏è **WARNING:** This key bypasses Row Level Security - keep it secret!
- Copy the key (starts with `eyJ...`)
- Add to `.env.local` as: `SUPABASE_SERVICE_ROLE_KEY`

---

## üìù Example .env.local File

Create/edit `.env.local` in your project root:

```bash
# ========================================
# SUPABASE CONFIGURATION
# ========================================
NEXT_PUBLIC_SUPABASE_URL=https://abcdefghijklmnop.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1ub3AiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMjQ4MDAwMCwiZXhwIjoxOTQ4MDU2MDAwfQ.abc123xyz
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1ub3AiLCJyb2xlIjoic2VydmljZV9yb2xlIiwiaWF0IjoxNjMyNDgwMDAwLCJleHAiOjE5NDgwNTYwMDB9.xyz789abc
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1ub3AiLCJyb2xlIjoic2VydmljZV9yb2xlIiwiaWF0IjoxNjMyNDgwMDAwLCJleHAiOjE5NDgwNTYwMDB9.xyz789abc

# ========================================
# APP CONFIGURATION
# ========================================
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_API_URL=http://localhost:3000

# ========================================
# OPTIONAL (for other features)
# ========================================
NEXTAUTH_SECRET=your-nextauth-secret-here
NEXTAUTH_URL=http://localhost:3000

# Test data (auto-generated by tests)
TEST_INTEGRATION_ID=
TEST_ORG_ID=
```

---

## ‚úÖ Verify Your Setup

### Option 1: Run the Setup Check Script

```bash
npm run check-env
```

Or manually:

```bash
./scripts/setup-test-env.sh
```

### Option 2: Manual Check

```bash
# Check if variables are set
source .env.local
echo "‚úÖ Supabase URL: ${NEXT_PUBLIC_SUPABASE_URL:0:30}..."
echo "‚úÖ Anon Key: ${NEXT_PUBLIC_SUPABASE_ANON_KEY:0:30}..."
echo "‚úÖ Service Key: ${SUPABASE_SERVICE_ROLE_KEY:0:30}..."
```

### Option 3: Run the Test

```bash
npm run test:multi-content-type
```

If you see this error:
```
‚ùå Missing Supabase credentials. Please set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY
```

Then your environment variables are not set correctly.

---

## üîß Quick Setup (Copy-Paste)

1. **Open terminal in your project directory**

2. **Edit .env.local** (create if it doesn't exist)
   ```bash
   nano .env.local
   # or
   code .env.local
   # or
   vim .env.local
   ```

3. **Paste the template above** and replace with your actual values

4. **Save and close**

5. **Verify**
   ```bash
   npm run test:multi-content-type
   ```

---

## üö® Security Notes

### ‚ö†Ô∏è NEVER commit these files:
- `.env.local`
- `.env.development.local`
- `.env.production.local`

These files are already in `.gitignore` - keep them there!

### ‚ö†Ô∏è Service Role Key Security:
- The `SUPABASE_SERVICE_ROLE_KEY` bypasses all Row Level Security (RLS)
- Never expose it to the client-side
- Never commit it to git
- Never share it publicly
- Only use it in server-side code and scripts

### ‚úÖ Safe to expose (client-side):
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `NEXT_PUBLIC_APP_URL`

These are prefixed with `NEXT_PUBLIC_` and are safe to expose to the browser.

---

## üéØ What Each Key Does

### `NEXT_PUBLIC_SUPABASE_URL`
- Your Supabase project URL
- Used by both client and server
- Safe to expose

### `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- Public API key for client-side Supabase requests
- Respects Row Level Security (RLS) policies
- Safe to expose

### `SUPABASE_SERVICE_ROLE_KEY`
- Server-side admin key
- Bypasses RLS policies
- **KEEP SECRET!**
- Used by test scripts to create/read test data

---

## üêõ Troubleshooting

### Error: "Missing Supabase credentials"
**Solution:** Add the required variables to `.env.local`

### Error: "Invalid API key"
**Solution:** Check that you copied the correct keys from Supabase dashboard

### Error: "Unauthorized"
**Solution:** 
1. Make sure `.env.local` is in the project root
2. Restart the dev server: `npm run dev`
3. Re-run the test

### Environment variables not loading
**Solution:**
1. Make sure `.env.local` is in the root directory
2. Check for typos in variable names
3. Restart your terminal/IDE
4. Verify with: `source .env.local && env | grep SUPABASE`

---

## üéâ Ready to Test?

Once your environment is set up:

```bash
# Run migration tests
npm run test:multi-content-type

# Run API tests (requires integration ID from previous test)
npm run test:multi-content-type-api -- --integration-id=YOUR_ID

# Check environment setup
./scripts/setup-test-env.sh
```

---

## üìö Next Steps

After setting up your environment:
1. ‚úÖ Run `npm run test:multi-content-type`
2. ‚úÖ Follow `QUICK_START_TESTING.md` for API tests
3. ‚úÖ Test the UI features
4. ‚úÖ Commit your changes


